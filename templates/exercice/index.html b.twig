{% extends 'baseback.html.twig' %}

{% block title %}AZIZ !{% endblock %}

{% block body %}
<div class="container-fluid">
    <div class="row">
        <div class="card">
            <div class="card-body">
                <div class="card-title">
                    <h4>Table Exercices</h4>
                </div>
                <div class="input-group mb-3">
                    <form id="searchForm" class="container-fluid">  
                        <div class="row">
                            <div class="col">
                                <input id="searchInput" type="text" class="form-control" name="search">
                            </div>
                            <div class="col-auto">
                                <button id="searchButton" class="btn btn-outline-dark btn-block" type="submit">Chercher</button>
                            </div>
                        </div>
                    </form>
                </div>
                <a href="{{ path('ex_add') }}"> 
                    <button class="btn btn-outline-dark btn-block" type="button">Ajouter</button> 
                </a>
                <br> 
                <div class="table-responsive">
                    <table id="exerciceTable" class="table table-hover">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Nom</th>
                                <th>Muscle Ciblé</th>
                                <th>Difficulté</th>
                                <th>Description</th>
                                <th>Image</th>
                                <th>Gif</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="searchResults">
                            <!-- Les données seront affichées ici dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block js %}
<script src="{{asset('Back/plugins/common/common.min.js')}}"></script>
    <script src="{{asset('Back/js/custom.min.js')}}"></script>
    <script src="{{asset('Back/js/settings.js')}}"></script>
    <script src="{{asset('Back/js/gleek.js')}}"></script>
    <script src="{{asset('Back/js/styleSwitcher.js')}}"></script>

    <!-- Chartjs -->
    <script src="{{asset('Back/plugins/chart.js/Chart.bundle.min.js')}}"></script>
    <!-- Circle progress -->
    <script src="{{asset('Back/plugins/circle-progress/circle-progress.min.js')}}"></script>
    <!-- Datamap -->
    <script src="{{asset('Back/plugins/d3v3/index.js')}}"></script>
    <script src="{{asset('Back/plugins/topojson/topojson.min.js')}}"></script>
    <script src="{{asset('Back/plugins/datamaps/datamaps.world.min.js')}}"></script>
    <!-- Morrisjs -->
    <script src="{{asset('Back/plugins/raphael/raphael.min.js')}}"></script>
    <script src="{{asset('Back/plugins/morris/morris.min.js')}}"></script>
    <!-- Pignose Calender -->
    <script src="{{asset('Back/plugins/moment/moment.min.js')}}"></script>
    <script src="{{asset('Back/plugins/pg-calendar/js/pignose.calendar.min.js')}}"></script>
    <!-- ChartistJS -->
    <script src="{{asset('Back/plugins/chartist/js/chartist.min.js')}}"></script>
    <script src="{{asset('Back/plugins/chartist-plugin-tooltips/js/chartist-plugin-tooltip.min.js')}}"></script>



    <script src="{{asset('Back/js/dashboard/dashboard-1.js')}}"></script>
<script>
    // Fonction pour effectuer une recherche
    function rechercherExercices(termeRecherche) {
        // Créer une instance de l'objet FormData
        var formData = new FormData();
        formData.append('search', termeRecherche);

        // Effectuer la requête Ajax pour récupérer les résultats de la recherche
        fetch('/search', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            // Vider le contenu de la table avant d'ajouter de nouveaux résultats
            document.getElementById('searchResults').innerHTML = '';

            // Manipuler les données JSON reçues et ajouter les nouveaux résultats
            var resultsHtml = '';
            console.log(data);
            data.weza.forEach(function(exercice) {
                // Construire le HTML pour chaque exercice
                resultsHtml += '<tr>';
                resultsHtml += '<td>' + exercice.id + '</td>';
                resultsHtml += '<td>' + exercice.nom + '</td>';
                resultsHtml += '<td>' + exercice.mc + '</td>';
                if (exercice.nd == 1) {
                    resultsHtml += '<td><span class="badge badge-success px-2" style="font-size: 12px;">Facile</span></td>';
                } else if (exercice.nd == 2) {
                    resultsHtml += '<td><span class="badge badge-primary px-2" style="font-size: 12px;">Moyen</span></td>';
                } else if (exercice.nd == 3) {
                    resultsHtml += '<td><span class="badge badge-danger px-2" style="font-size: 12px;">Difficile</span></td>';
                }
                resultsHtml += '<td class="color-primary"><div style="width: 400px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">' + exercice.des + '</div></td>';
                resultsHtml += '<td><img src="' + exercice.img + '" width="58%" height="58%" /></td>';
                resultsHtml += '<td><img src="' + exercice.gif + '" width="25%" height="25%" /></td>';
                resultsHtml += '<td><a href="/bexercice/m/' + exercice.id + '"><button type="submit" class="btn btn-dark btn-block">Modifier</button></a><br><a href="/bexercice/d/' + exercice.id + '"><button type="submit" class="btn btn-dark btn-block">Supprimer</button></a></td>';
                resultsHtml += '</tr>';
            });

            // Mettre à jour l'interface utilisateur avec les nouveaux résultats de la recherche
            document.getElementById('searchResults').innerHTML = resultsHtml;
        })
        .catch(error => {
            console.error('Erreur lors de la requête:', error);
        });
    }

    // Événement pour soumettre le formulaire de recherche
    document.getElementById('searchForm').addEventListener('submit', function(event) {
        event.preventDefault(); // Empêcher la soumission du formulaire par défaut
        var searchTerm = document.getElementById('searchInput').value;
        rechercherExercices(searchTerm);
    });

    // Charge initiale des exercices
    document.addEventListener('DOMContentLoaded', function() {
        rechercherExercices('');
    });
</script>
{% endblock %}